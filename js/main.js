"use strict";angular.module("tvApp",["ngResource"]),angular.module("tvApp").constant("endpoint","http://server.pi.campinhos.pt"),angular.module("tvApp").controller("MainCtrl",function($scope){$scope.dummy=[1,2,3]}),angular.module("tvApp").controller("WeatherCtrl",function($scope,$timeout,$http,WeatherService){var update=1;!function tick(){WeatherService.getWeather().then(function(data){JSON.stringify($scope.weather)!==JSON.stringify(data)&&($scope.weather=data),$timeout(tick,60*update*1e3)})}()}),angular.module("tvApp").controller("BroadcastCtrl",function($scope,BroadcastService){$scope.counter=0;var getData=function(){BroadcastService.get().then(function(data){$scope.all=data,$scope.next()})};$scope.next=function(){0===$scope.all.length?setTimeout(getData,12e4):$scope.counter<$scope.all.length?($scope.message=$scope.all[$scope.counter],$scope.counter++,$scope.$$phase||$scope.$digest()):($scope.counter=0,getData())},getData()}),angular.module("tvApp").controller("ContentCtrl",function($scope,ContentService,$timeout){var d,n=0,ni=0,get=function(){ContentService.get().then(function(data){d=data,prepare()})},prepare=function(){$scope.trigger=!$scope.trigger||!1,$scope.name=d[0].content[ni].name,$scope.title=d[0].type,$scope.data=d[0].content[ni],delete $scope.data.name,n>d.length-1?(n=0,ni=0,$timeout(get,5e3)):(n++,ni++,$timeout(prepare,5e3))};get()}),angular.module("tvApp").controller("VideoCtrl",function($scope,VideosService){var curr=0;VideosService.get().then(function(data){$scope.videos=data,getcurr()}),$scope.next=function(){getcurr()};var getcurr=function(){$scope.title=$scope.videos[curr].name,$scope.id=$scope.videos[curr].videoId,curr===$scope.videos.length-1?curr=0:curr++}}),angular.module("tvApp").factory("WeatherService",function($http,endpoint){return{getWeather:function(){return $http({method:"GET",url:endpoint+"/api/tv/weather"}).then(function(response){return response.data})}}}),angular.module("tvApp").factory("BroadcastService",function($http,endpoint){return{get:function(){return $http({method:"GET",url:endpoint+"/api/tv/strikes"}).then(function(response){return response.data})}}}),angular.module("tvApp").factory("ContentService",function($http,endpoint){return{get:function(){return $http({method:"GET",url:endpoint+"/api/tv/content"}).then(function(response){return response.data})}}}),angular.module("tvApp").factory("VideosService",function($http,endpoint){return{get:function(){return $http({method:"GET",url:endpoint+"/api/tv/schedule"}).then(function(response){return response.data})}}}),angular.module("tvApp").directive("time",function(){return function(scope,element,attrs){"hours"===attrs.type&&setInterval(function(){var hours=(new Date).getHours();element.html((10>hours?"0":"")+hours)},1e3),"minutes"===attrs.type&&setInterval(function(){var minutes=(new Date).getMinutes();element.html((10>minutes?"0":"")+minutes)},1e3)}}),angular.module("tvApp").directive("svg",function($http){return function(scope,element,attrs){var icon=function(){scope.weather&&$http({method:"GET",url:attrs.data}).success(function(data){element[0].outerHTML=data})};scope.$watch("weather",function(){icon()})}}),angular.module("tvApp").directive("temp",function(){return function(scope,element){var color=function(){scope.weather&&element.addClass(scope.weather.temp<20?"color-blue":scope.weather.temp<27?"color-yellow":"color-red")};scope.$watch("weather",function(){color()})}}),angular.module("tvApp").directive("broadcast",function(){return function(scope,element){var colors={Importante:"red","Informação":"blue",Greve:"green"},count=0;scope.$watch("message",function(){scope.message&&($(".texto").html("").unbind("finished"),count=0,create())});var create=function(){scope.color=colors[scope.message.type],element.html(scope.message.text),$(".texto").marquee().bind("finished",function(){scope.next()})}}}),angular.module("tvApp").directive("colortag",function(){return function(scope){var colors={Ementas:"yellow",Transportes:"green"};scope.$watch("title",function(){scope.color=colors[scope.title]})}}),angular.module("tvApp").directive("youtube",function($window){return function(scope){scope.$watch("id",function(){function newPlaya(){player=new YT.Player("player",{videoId:scope.id,playerVars:{autoplay:1,controls:1,modestbranding:0,showinfo:0,rel:0},events:{onStateChange:onPlayerStateChange}})}function onPlayerStateChange(event){console.log(event.data),0===event.data&&scope.next()}'<div id="player"></div>'!==$(".video").html().trim()&&($(".video").html('<div id="player"></div>'),newPlaya());var player;$window.onYouTubeIframeAPIReady=function(){newPlaya()}})}}),angular.module("tvApp").directive("animinus",function(){return function(scope,elem){var a=function(){$(elem).animate({width:"0%"},5e3,function(){$(elem).attr("style","")})};scope.$watch("trigger",function(){a()})}}),angular.module("tvApp").directive("animfade",function($timeout){return function(scope,elem){var ignore=!0;scope.$watch("trigger",function(){ignore&&($timeout(anim,4e3),ignore=!ignore,$timeout(function(){$(elem).fadeOut(1e3).fadeIn(2e3)},4e3))});var anim=function(){setInterval(function(){$(elem).fadeOut(1e3).fadeIn(2e3)},5e3)}}}),angular.module("tvApp").filter("weatherIcon",function(){var states={chanceflurries:null,chancerain:null,chancesleet:null,chancesnow:null,chancetstorms:null,clear:"sun",cloudy:"cloud",flurries:"cloudHailAlt",fog:"cloudFog",hazy:"cloudFogSun",mostlycloudy:"cloudSun",mostlysunny:"cloudSun",partlycloudy:"cloudSun",partlysunny:"cloudSun",sleet:"cloudHailAlt",rain:"cloudRain",snow:"cloudSnowAlt",sunny:"sun",tstorms:"cloudLightning",unknown:"cloudLightning"};return function(input){return states[input]}});